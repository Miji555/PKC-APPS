<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download & Updates</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script>
    (function() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const appId = urlParams.get('appId');
        if (appId) {
          const meta = document.createElement('meta');
          meta.name = 'apple-itunes-app';
          meta.content = 'app-id=' + appId;
          document.head.appendChild(meta);
        }
      } catch (e) {
        console.error('Error injecting smart banner:', e);
      }
    })();
  </script>

  <style>
    body {
      font-family: 'Inter', 'Noto Sans Thai', sans-serif;
      background-color: #ffffff;
      color: #1a1a1a;
    }
    .animate-in {
      animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React from 'react';
    import ReactDOM from 'react-dom/client';

    const CATEGORIES = [
      {
        id: 'games',
        title: 'Games',
        apps: [
          {
            id: 'minecraft',
            name: 'Minecraft: สร้างโลกของคุณ',
            subtitle: 'เกมจำลองการสร้างบล็อก',
            url: 'https://apps.apple.com/th/app/minecraft/id479516143',
            icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/91/9e/7b/919e7b30-c831-50e5-7973-206e0176f183/AppIcon-0-0-1x_U007emarketing-0-10-0-85-220.png/100x100bb.png'
          },
          {
            id: 'rov',
            name: 'Garena RoV: 5v5 Festival',
            subtitle: 'สุดยอดเกม MOBA 5v5 บนมือถือ',
            url: 'https://apps.apple.com/th/app/garena-rov-5v5-festival/id1150337432',
            icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/21/92/8a/21928ab1-2a6c-e06a-9351-831518f9746b/AppIcon-0-0-1x_U007emarketing-0-10-0-85-220.png/100x100bb.png'
          },
          {
            id: 'freefire',
            name: 'Garena Free Fire: The Chaos',
            subtitle: 'เกมยิงปืนเอาตัวรอดอันดับ 1',
            url: 'https://apps.apple.com/th/app/garena-free-fire-the-chaos/id1300146617',
            icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/4a/01/21/4a01217e-976e-578a-c97a-9694769036c0/AppIcon-0-0-1x_U007emarketing-0-10-0-85-220.png/100x100bb.png'
          }
        ]
      },
      {
        id: 'utility',
        title: 'Utility',
        apps: [
          {
            id: 'meitu',
            name: 'Meitu- Photo & Video Editor',
            subtitle: 'แต่งรูปสวยและวีดีโอ',
            url: 'https://apps.apple.com/th/app/meitu-photo-video-editor/id416048305',
            icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/4a/04/00/4a040082-9092-23c5-6804-06927d118933/AppIcon-0-0-1x_U007emarketing-0-10-0-85-220.png/100x100bb.png'
          },
          {
            id: 'spotify',
            name: 'Spotify - Music and Podcasts',
            subtitle: 'ฟังเพลงและพอดแคสต์',
            url: 'https://apps.apple.com/th/app/spotify-music-and-podcasts/id324684580',
            icon: 'https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/7e/f0/a0/7ef0a012-70b1-129a-2481-2090875e656d/AppIcon-0-0-1x_U007emarketing-0-10-0-85-220.png/100x100bb.png'
          }
        ]
      }
    ];

    const getAppleId = (url) => {
      if (!url) return null;
      const match = url.match(/id(\d+)/);
      return match ? match[1] : null;
    };

    const Header = () => {
      return (
        <div className="mb-8 border-b border-[#d0d7de] pb-8 flex flex-col items-center text-center">
          <img 
            src="logo.png" 
            alt="Logo" 
            className="h-28 w-auto mb-4 object-contain shadow-sm"
            onError={(e) => {
                e.target.onerror = null; 
                e.target.style.display = 'none';
                console.warn("Logo image failed to load. Ensure 'logo.png' is in the root directory.");
            }}
          />
          <h1 className="text-2xl font-bold text-[#1f2328] mb-1">
            Download and Updates
          </h1>
          <p className="text-[#636c76]">
            Download and update เท่านั้น
          </p>
        </div>
      );
    };

    const CategorySection = ({ category }) => {
      if (category.apps.length === 0) return null;
      return (
        <div className="border border-[#d0d7de] rounded-md overflow-hidden bg-white">
          <div className="bg-[#f6f8fa] px-4 py-3 border-b border-[#d0d7de] flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <svg className="w-4 h-4 text-[#636c76]" viewBox="0 0 16 16" fill="currentColor">
                <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2c-.33-.44-.85-.7-1.4-.7h-3.25z"></path>
              </svg>
              <span className="font-semibold text-[#1f2328] text-sm">{category.title}</span>
            </div>
            <span className="text-xs text-[#636c76]">{category.apps.length} items</span>
          </div>
          <div className="divide-y divide-[#d0d7de]">
            {category.apps.map((app) => {
              const appleId = getAppleId(app.url);
              const href = appleId ? `?appId=${appleId}` : app.url;
              return (
                <div key={app.id} className="px-4 py-3 hover:bg-[#f6f8fa] transition-colors flex items-center justify-between group">
                  <div className="flex items-center space-x-3 overflow-hidden">
                    <img src={app.icon} className="w-10 h-10 rounded-lg flex-shrink-0 shadow-sm" referrerPolicy="no-referrer" />
                    <div className="flex flex-col truncate">
                      <a href={href} className="text-[#0969da] font-medium hover:underline text-sm truncate">{app.name}</a>
                      {app.subtitle && <span className="text-[11px] text-[#636c76] truncate">{app.subtitle}</span>}
                    </div>
                  </div>
                  <a href={href} className="text-xs font-medium text-[#1f2328] bg-white border border-[#d0d7de] px-3 py-1.5 rounded shadow-sm hover:bg-[#f3f4f6] transition-colors whitespace-nowrap opacity-0 group-hover:opacity-100 focus:opacity-100">Download</a>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const DetailView = ({ appId }) => {
        const app = CATEGORIES.flatMap(c => c.apps).find(a => getAppleId(a.url) === appId);
        if (!app) return <div className="text-center py-20"><p>App not found</p><a href="/" className="text-blue-500">Go Home</a></div>;

        return (
            <div className="flex flex-col items-center pt-8 px-4 text-center animate-in">
                 <img src={app.icon} className="w-24 h-24 rounded-[22px] mb-6 shadow-md border border-gray-100" referrerPolicy="no-referrer" />
                 <h1 className="text-2xl font-bold text-[#1f2328] mb-1">{app.name}</h1>
                 <h2 className="text-xl font-semibold text-[#0969da] mb-8">Download & updates</h2>
                 <div className="w-full max-w-md bg-yellow-50 border border-yellow-200 rounded-lg p-5 mb-8 text-left">
                    <div className="flex gap-3">
                        <svg className="w-6 h-6 text-yellow-600 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                        </svg>
                        <p className="text-yellow-800 text-sm font-semibold leading-relaxed">
                           ใช้ Safari เท่านั้น ถ้าแอพไม่ขึ้นให้ Download ลองเข้าออก Safari ใหม่ หรือ Restart iPad ของคุณ
                        </p>
                    </div>
                 </div>
                 <a href={window.location.pathname} className="text-sm text-[#0969da] hover:underline flex items-center font-medium bg-blue-50 px-6 py-2 rounded-full transition-colors">
                    Back to Apps
                 </a>
            </div>
        );
    };

    const App = () => {
      const [view, setView] = React.useState('list');
      const [currentAppId, setCurrentAppId] = React.useState(null);

      React.useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const appId = params.get('appId');
        if (appId) {
            setCurrentAppId(appId);
            setView('detail');
        } else {
            setView('list');
        }
      }, []);

      return (
        <div className="min-h-screen bg-slate-50/30 py-8 px-4 flex flex-col items-center">
          <div className="w-full max-w-3xl">
            <Header />
            {view === 'list' ? (
                <div className="space-y-6">
                    {CATEGORIES.map((category) => <CategorySection key={category.id} category={category} />)}
                </div>
            ) : <DetailView appId={currentAppId} />}
            <footer className="mt-16 pt-8 border-t border-[#d0d7de] text-center text-[#636c76] text-xs">
              <p>© {new Date().getFullYear()} PKC APPS • ระบบดาวน์โหลดและอัปเดตอัตโนมัติ</p>
            </footer>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<React.StrictMode><App /></React.StrictMode>);
  </script>
</body>
</html>